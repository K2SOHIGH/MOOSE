#!/usr/bin/env python3
# -*- coding: utf-8 -*-
import os
import argparse
import sys
import multiprocessing
from utils import utils
from utils import log

logger = log.setlogger(__name__)

def get_args():
    parser = argparse.ArgumentParser(
        prog=__name__,
        description='Use anvi\'o to quickly estimate genomes quality and taxonomy')

    parser.add_argument(
        '-i',
        '--input',
        dest="genome_input",
        type=str,
        required=True,
        help="yaml file containing path to fasta files , a fasta file or a directory containing fasta files"
        )
    
    parser.add_argument(
        '-e',
        '--extension',
        dest = "genome_extension",
        type=str,
        default=".fna.gz",
        help="genome file extension"
    )

    parser.add_argument('-o', '--output-dir' , dest="RESDIR" , default = "." , type=str)

    parser.add_argument('-d', '--db' , dest="DBDIR"  , default = None , type=str , help="where anvi'o database should be stored")
            
    parser.add_argument(        
        '--threads',
        type = int,
        default = multiprocessing.cpu_count()-1,
        help = "number of threads",
    )

    parser.add_argument('--snakargs', dest='snakargs', type=str, default="",
            help='snakmake arguments')

    args = parser.parse_args()
    return args

def main():
    args = get_args()                
    
    f = os.path.abspath(os.path.join(__file__, ".." , ".." , "resources" , "anviodb.txt" )  )
    
    args.dbfile = f

    utils.module(
            "anvio-estimate-module",
            os.path.join( os.path.abspath( os.path.dirname(__file__)) , "../condaenvs"),
            args
        )

if __name__ == "__main__":
    sys.exit(main())

    